---
title: "BasketballStats"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library('knitr')
library(R.matlab)
library(leaps)
library(MASS)
library(magrittr)
library(dtplyr)
library(boot)
library(e1071)
library(glmnet)

set.seed(123)
```

## R Markdown

```{r}
Ball_data = read.csv("data/team_season.csv", header = T)
#smp_size <- floor(0.75 * nrow(data))
#orders = sample(c(1:nrow(data)), 0.7*nrow(data), replace = FALSE, prob = NULL)
#Ball_data <- data[orders, ]
#test <- data[-orders, ]

wins = (Ball_data$won)/(Ball_data$won + Ball_data$lost)

Ball_data <- cbind.data.frame(Ball_data, wins)
Ball_data$won <- NULL
Ball_data$lost <- NULL
#pca = prcomp(data[,4:36], scale. = T, center = T)
#summary(pca)

head(Ball_data)
fitF <- regsubsets(wins ~., data=Ball_data, nvmax = ncol(Ball_data), method = "forward")
fitFS <- summary(fitF)
fitFBICN <- which.min(fitFS$bic)
fitFBIC <- coef(fitF, fitFBICN)
fitFBIC

fitB <- regsubsets(wins ~., data=Ball_data, nvmax = ncol(Ball_data), method = "backward")
fitBS <- summary(fitB)
fitBBICN <- which.min(fitBS$bic)
fitBBIC <- coef(fitB, fitBBICN)
fitBBIC
```

```{r, results = "hide"}
mod_bwd <- stepAIC(lm(wins ~ team + year + o_fgm + o_fga + o_ftm + o_fta + o_oreb + o_dreb + o_reb + o_asts + o_pf + o_stl + o_to + o_blk + o_3pm + o_3pa + o_pts + d_fgm + d_fga + d_ftm + d_fta + d_oreb + d_dreb + d_reb + d_asts + d_pf + d_stl + d_to +d_blk + d_3pm + d_3pa + d_pts   + pace, data = Ball_data), direction = "backward", test = "F")
#sqrtRE_bwd <- summary(mod_bwd)$sigma
#sqrtRE_bwd
```

```{r}
#Cross Validation Process with K-Fold method
#mod <- glm(wins ~ o_fgm + o_ftm + o_3pm + d_fga + d_ftm + d_3pa + d_3pa^2, data = Ball_data)
LRBIC_mod <- glm(wins ~ o_ftm + d_fgm + d_ftm + d_pf +  d_3pm +  pace, data = Ball_data)

#mod <- glm(wins ~ o_pts + o_pts^2 + d_fga + d_ftm + d_ftm^2 + d_3pa + d_3pa^2, data = Ball_data)
#mod <- glm(wins ~ o_pts + d_fga + d_fgm + d_ftm +  d_3pm, data = Ball_data) 
#mod <- glm(wins ~ o_fgm + o_fga + o_ftm + o_fta + o_oreb + o_dreb + o_reb + o_asts + o_pf + o_stl + o_to + o_blk + o_3pm + o_3pa + o_pts + d_fgm + d_fga + d_ftm + d_fta + d_oreb + d_dreb + d_reb + d_asts + d_pf + d_stl + d_to +d_blk + d_3pm + d_3pa + d_pts + pace, data = Ball_data, family = binomial()) 
#backward <- step(mod)
#summary(backward)
RLBL_mod <- glm(formula = wins ~ o_fgm + o_fga + o_ftm + o_fta + o_oreb + o_dreb + o_reb + o_asts + o_pf + o_stl + o_to + o_blk + o_3pm + o_3pa + o_pts + d_fgm + d_fga + d_ftm + d_fta + d_oreb + d_dreb + d_reb + d_asts + d_pf + d_stl + d_to +d_blk + d_3pm + d_3pa + d_pts   + pace, data = Ball_data)
#mod <- svm(wins ~ o_fgm + o_ftm + o_3pm + d_pts, data = Ball_data)
svm_mod <- svm(wins ~ o_pts + d_fga + d_fgm + d_ftm +  d_3pm, data = Ball_data)
#mod <- svm(wins ~ o_fgm + o_ftm + o_3pm + d_fga + d_ftm + d_fta + d_3pa, data= Ball_data) 
LRAIC_mod <- glm(wins ~ o_fgm + o_fga + o_ftm + o_oreb + o_asts + o_to + o_3pm + d_fgm + d_fga + d_ftm + d_to + d_blk + d_3pm, data = Ball_data)
summary(svm_mod)
#CV <- cv.glm(data = Ball_data, glmfit = mod, K = 10)$delta
#CV
#CV_2 <- CV^.5
#CV_2
```


LRAIC_P <- predict (LRAIC_mod)
Tu_Huy <- predict(svm_mod, newdata = test)
Results <- data.frame((test$won)/(test$won+test$lost))
write.csv(cbind.data.frame(Tu_Huy, Results), file="Tu_Huy.csv")
head(Tu_Huy)
E <- data.frame(Tu_Huy) - Results
sum(abs(E))/nrow(data.frame(Tu_Huy))
SE <- (E*100)^2
sum(SE)/nrow(data.frame(Tu_Huy))
sum(abs(E))/nrow(data.frame(Tu_Huy))


SVM_P <- predict(svm_mod)
ResultsTr <- Ball_data$wins
E <- mean((SVM_P*100 - ResultsTr*100)^2)
E



**

x <- as.matrix(cbind(Ball_data$o_fgm, Ball_data$o_fga, Ball_data$o_ftm, Ball_data$o_oreb, Ball_data$o_asts, Ball_data$o_to, Ball_data$o_3pm, Ball_data$d_fgm, Ball_data$d_fga, Ball_data$d_ftm, Ball_data$d_to, Ball_data$d_blk, Ball_data$d_3pm))
y <- as.matrix(Ball_data$wins)
lassomod <- glmnet(x=x,y=y, alpha=1, family='gaussian')
ridgemod <- glmnet(x=x,y=y, alpha=0, family='gaussian')
summary(lassomod)
summary(ridgemod)
xtest <- as.matrix(cbind(test$o_fgm, test$o_fga, test$o_ftm, test$o_oreb, test$o_asts, test$o_to, test$o_3pm, test$d_fgm, test$d_fga, test$d_ftm, test$d_to, test$d_blk, test$d_3pm))
ytest <- Results
lasso_Ball_data_pred <- predict(lassomod, x, type="link")
ridge_Ball_data_pred <- predict(ridgemod, x, type="link")
lasso_test_pred <- predict(lassomod, xtest, type="link")
ridge_test_pred <- predict(ridgemod, xtest, type="link")

lasso_Ball_data_rmse <- sqrt(mean((Ball_data$wins*100 - lasso_Ball_data_pred*100)^2))
ridge_Ball_data_rmse <- sqrt(mean((Ball_data$wins*100 - ridge_Ball_data_pred*100)^2))
lasso_test_rmse <- sqrt(mean((ytest*100 - lasso_test_pred*100)^2))
ridge_test_rmse <- sqrt(mean((ytest*100 - ridge_test_pred*100)^2))
print(lasso_Ball_data_rmse)
print(ridge_Ball_data_rmse)
print(lasso_test_rmse)
print(ridge_test_rmse)



wins <- (test$won)/(test$won+test$lost)
test <- cbind.data.frame(test, wins)

plot(test$wins)
abline(lassomod, lwd=2)